<!doctype html>
<html lang="it">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>OBLIVION - Streaming di Film</title>
    <link rel="stylesheet" href="css/style.css" />
    <link rel="preconnect" href="https://image.tmdb.org" />
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/animate.css/4.1.1/animate.min.css">
    
    <!-- Meta tags per SEO e social -->
    <meta name="description" content="OBLIVION - Piattaforma di streaming film gratuita. Guarda film popolari, top rated e in tendenza.">
    <meta name="keywords" content="film, streaming, gratis, movie, cinema, Netflix style">
    <meta property="og:title" content="OBLIVION - Streaming Film">
    <meta property="og:description" content="Piattaforma di streaming film gratuita">
    <meta property="og:type" content="website">
    
    <!-- Favicon -->
    <link rel="icon" type="image/x-icon" href="favicon.ico">
    
    <!-- Preload risorse critiche -->
    <link rel="preload" href="css/style.css" as="style">
    <link rel="preload" href="js/app.js" as="script">
    <link rel="preload" href="js/tmdb.js" as="script">
  </head>

  <body>
    <!-- Header fisso migliorato -->
    <header class="netflix-header">
      <div class="nav-left">
        <h1 class="logo">
          <i class="fas fa-film logo-icon"></i>
          OBLIVION
          <span class="beta-badge">BETA</span>
        </h1>
        <nav class="main-nav" aria-label="Navigazione principale">
          <ul>
            <li><a href="#" class="active" data-category="trending" aria-current="page"><i class="fas fa-fire"></i> Home</a></li>
            <li><a href="#" data-category="popular"><i class="fas fa-chart-line"></i> Popolari</a></li>
            <li><a href="#" data-category="top_rated"><i class="fas fa-star"></i> Top Rated</a></li>
            <li><a href="#" id="favoritesLink"><i class="fas fa-heart"></i> Preferiti</a></li>
            <li><a href="#" id="historyLink"><i class="fas fa-history"></i> Cronologia</a></li>
          </ul>
        </nav>
      </div>
      
      <div class="nav-right">
        <div class="search-box">
          <input id="searchInput" type="text" placeholder="Cerca film, serie, attori..." autocomplete="off" aria-label="Cerca film">
          <button id="searchBtn" class="search-btn" aria-label="Esegui ricerca"><i class="fas fa-search"></i></button>
          <div class="search-suggestions" id="searchSuggestions"></div>
        </div>
        
        <div class="user-menu">
          <button class="user-btn" id="userMenuBtn" aria-label="Menu utente">
            <i class="fas fa-user-circle"></i>
            <i class="fas fa-caret-down"></i>
          </button>
          <div class="user-dropdown" id="userDropdown">
            <a href="#"><i class="fas fa-user"></i> Profilo</a>
            <a href="#" id="settingsLink"><i class="fas fa-cog"></i> Impostazioni</a>
            <div class="dropdown-divider"></div>
            <a href="#" id="logoutLink"><i class="fas fa-sign-out-alt"></i> Esci</a>
          </div>
        </div>
        
        <button class="theme-toggle" id="themeToggle" aria-label="Cambia tema">
          <i class="fas fa-moon"></i>
        </button>
      </div>
    </header>

    <!-- Ad-block warning (simile a streamingunity) -->
    <div id="adblockWarning" class="adblock-warning" style="display: none;">
      <div class="warning-content">
        <i class="fas fa-exclamation-triangle"></i>
        <p>Rilevato ad-blocker. Per supportare il sito, considera di disabilitarlo per questa pagina.</p>
        <button id="closeAdblockWarning" class="btn-small">Capito</button>
      </div>
    </div>

    <!-- Hero Section migliorata -->
    <section class="hero" id="heroSection">
      <div class="hero-backdrop" id="heroBackdrop"></div>
      <div class="hero-gradient"></div>
      
      <div class="hero-content">
        <div class="hero-badge">NUOVO</div>
        <h1 id="heroTitle" class="animate__animated animate__fadeInDown">Film in Trend</h1>
        <div class="hero-meta">
          <span class="hero-rating"><i class="fas fa-star"></i> <span id="heroRating">4.5</span>/5</span>
          <span class="hero-year" id="heroYear">2023</span>
          <span class="hero-duration" id="heroDuration">2h 15m</span>
          <span class="hero-hd">HD</span>
        </div>
        <p id="heroDescription">Scopri i film più popolari del momento. Guarda trailer, leggi trame e trova dove guardarli.</p>
        <div class="hero-buttons">
          <button class="btn btn-play"><i class="fas fa-play"></i> Riproduci</button>
          <button class="btn btn-info"><i class="fas fa-info-circle"></i> Altre info</button>
          <button class="btn btn-favorite" id="heroFavoriteBtn"><i class="far fa-heart"></i> Aggiungi ai preferiti</button>
          <button class="btn btn-trailer" id="heroTrailerBtn"><i class="fas fa-play-circle"></i> Guarda trailer</button>
        </div>
        
        <div class="hero-features">
          <div class="feature">
            <i class="fas fa-tv"></i>
            <span>Streaming HD</span>
          </div>
          <div class="feature">
            <i class="fas fa-closed-captioning"></i>
            <span>Sottotitoli IT</span>
          </div>
          <div class="feature">
            <i class="fas fa-download"></i>
            <span>Download</span>
          </div>
          <div class="feature">
            <i class="fas fa-users"></i>
            <span>Multi-piattaforma</span>
          </div>
        </div>
      </div>
      
      <button class="hero-scroll" id="scrollToContent" aria-label="Scorri verso il basso">
        <i class="fas fa-chevron-down"></i>
      </button>
    </section>

    <!-- Filtri e controlli -->
    <div class="filters-bar">
      <div class="filters-container">
        <h3 class="filters-title">Filtra per:</h3>
        <div class="filters">
          <select id="genreFilter" class="filter-select" aria-label="Filtra per genere">
            <option value="">Tutti i generi</option>
            <!-- Popolato dinamicamente -->
          </select>
          
          <select id="yearFilter" class="filter-select" aria-label="Filtra per anno">
            <option value="">Tutti gli anni</option>
            <!-- Popolato dinamicamente -->
          </select>
          
          <select id="sortFilter" class="filter-select" aria-label="Ordina per">
            <option value="popularity">Popolarità</option>
            <option value="vote_average">Voto</option>
            <option value="release_date">Data uscita</option>
            <option value="title">Titolo</option>
          </select>
          
          <button class="filter-btn active" data-filter="all">Tutti</button>
          <button class="filter-btn" data-filter="movie">Film</button>
          <button class="filter-btn" data-filter="tv">Serie TV</button>
        </div>
      </div>
      
      <div class="view-controls">
        <button class="view-btn active" data-view="grid" aria-label="Visualizzazione griglia">
          <i class="fas fa-th"></i>
        </button>
        <button class="view-btn" data-view="list" aria-label="Visualizzazione lista">
          <i class="fas fa-list"></i>
        </button>
      </div>
    </div>

    <!-- Main Content -->
    <main class="main-content" id="mainContent">
      <!-- Rows Container -->
      <div class="rows" id="rowsContainer">
        <!-- Trending Row -->
        <section class="row" id="trendingRow" aria-labelledby="trendingTitle">
          <div class="row-header">
            <h2 id="trendingTitle"><i class="fas fa-fire"></i> In Trend</h2>
            <a href="#" class="row-more">Mostra tutti <i class="fas fa-arrow-right"></i></a>
          </div>
          <div class="scroller" id="trendingScroller"></div>
        </section>

        <!-- Popular Row -->
        <section class="row" id="popularRow" aria-labelledby="popularTitle">
          <div class="row-header">
            <h2 id="popularTitle"><i class="fas fa-chart-line"></i> Popolari su OBLIVION</h2>
            <a href="#" class="row-more">Mostra tutti <i class="fas fa-arrow-right"></i></a>
          </div>
          <div class="scroller" id="popularScroller"></div>
        </section>

        <!-- Top Rated Row -->
        <section class="row" id="topRatedRow" aria-labelledby="topRatedTitle">
          <div class="row-header">
            <h2 id="topRatedTitle"><i class="fas fa-star"></i> Più Votati</h2>
            <a href="#" class="row-more">Mostra tutti <i class="fas fa-arrow-right"></i></a>
          </div>
          <div class="scroller" id="topRatedScroller"></div>
        </section>

        <!-- Upcoming Row -->
        <section class="row" id="upcomingRow" aria-labelledby="upcomingTitle">
          <div class="row-header">
            <h2 id="upcomingTitle"><i class="fas fa-calendar-alt"></i> Prossimamente</h2>
            <a href="#" class="row-more">Mostra tutti <i class="fas fa-arrow-right"></i></a>
          </div>
          <div class="scroller" id="upcomingScroller"></div>
        </section>

        <!-- Search Results (hidden by default) -->
        <section class="row search-results" id="searchResultsRow" style="display: none;" aria-labelledby="searchResultsTitle">
          <div class="row-header">
            <h2 id="searchResultsTitle"><i class="fas fa-search"></i> Risultati della ricerca</h2>
            <button class="clear-search" id="clearSearchBtn">Cancella ricerca</button>
          </div>
          <div class="scroller" id="searchResultsScroller"></div>
        </section>

        <!-- Favorites Row -->
        <section class="row favorites-row" id="favoritesRow" style="display: none;" aria-labelledby="favoritesTitle">
          <div class="row-header">
            <h2 id="favoritesTitle"><i class="fas fa-heart"></i> I tuoi preferiti</h2>
            <button class="clear-favorites" id="clearFavoritesBtn">Svuota preferiti</button>
          </div>
          <div class="scroller" id="favoritesScroller"></div>
        </section>
      </div>
    </main>

    <!-- Player Modal -->
    <div id="playerModal" class="modal player-modal" aria-hidden="true" role="dialog" aria-label="Player video">
      <div class="modal-content player-content">
        <button class="close player-close" type="button" aria-label="Chiudi player"><i class="fas fa-times"></i></button>
        <div class="player-container">
          <div class="player-placeholder" id="playerPlaceholder">
            <i class="fas fa-play-circle"></i>
            <p>Il player verrà caricato qui</p>
          </div>
        </div>
      </div>
    </div>

    <!-- MODAL dettagli film migliorato -->
    <div id="movieModal" class="modal movie-modal" aria-hidden="true" role="dialog" aria-label="Dettagli film">
      <div class="modal-content movie-content">
        <button class="close movie-close" type="button" aria-label="Chiudi dettagli"><i class="fas fa-times"></i></button>
        <div class="movie-modal-body">
          <div class="movie-modal-left">
            <div class="movie-modal-poster" id="modalPoster"></div>
            <div class="movie-modal-actions">
              <button class="modal-btn play-btn"><i class="fas fa-play"></i> Riproduci</button>
              <button class="modal-btn favorite-btn"><i class="far fa-heart"></i> Preferiti</button>
              <button class="modal-btn trailer-btn"><i class="fas fa-play-circle"></i> Trailer</button>
              <button class="modal-btn share-btn"><i class="fas fa-share-alt"></i> Condividi</button>
            </div>
          </div>
          <div class="movie-modal-right" id="movieDetails">
            <!-- Popolato dinamicamente -->
          </div>
        </div>
      </div>
    </div>

    <!-- Settings Modal -->
    <div id="settingsModal" class="modal settings-modal" aria-hidden="true" role="dialog" aria-label="Impostazioni">
      <div class="modal-content settings-content">
        <button class="close settings-close" type="button" aria-label="Chiudi impostazioni"><i class="fas fa-times"></i></button>
        <h2><i class="fas fa-cog"></i> Impostazioni</h2>
        <div class="settings-body">
          <div class="setting-group">
            <h3>Video</h3>
            <div class="setting-item">
              <label for="videoQuality">Qualità video predefinita</label>
              <select id="videoQuality">
                <option value="auto">Automatica</option>
                <option value="1080">1080p</option>
                <option value="720">720p</option>
                <option value="480">480p</option>
              </select>
            </div>
            <div class="setting-item">
              <label>
                <input type="checkbox" id="autoplayNext">
                Autoplay episodio successivo
              </label>
            </div>
          </div>
          
          <div class="setting-group">
            <h3>Account</h3>
            <div class="setting-item">
              <label for="language">Lingua interfaccia</label>
              <select id="language">
                <option value="it">Italiano</option>
                <option value="en">English</option>
              </select>
            </div>
          </div>
          
          <div class="setting-group">
            <h3>Privacy</h3>
            <div class="setting-item">
              <label>
                <input type="checkbox" id="saveHistory">
                Salva cronologia visualizzazione
              </label>
            </div>
            <div class="setting-item">
              <label>
                <input type="checkbox" id="showRecommendations">
                Mostra raccomandazioni personalizzate
              </label>
            </div>
          </div>
          
          <button class="btn btn-save" id="saveSettingsBtn">Salva impostazioni</button>
        </div>
      </div>
    </div>

    <!-- Loading Overlay migliorato -->
    <div id="loadingOverlay" class="loading-overlay">
      <div class="loading-content">
        <div class="spinner">
          <div class="bounce1"></div>
          <div class="bounce2"></div>
          <div class="bounce3"></div>
        </div>
        <p>Caricamento...</p>
        <div class="loading-progress" id="loadingProgress">
          <div class="progress-bar"></div>
        </div>
      </div>
    </div>

    <!-- Footer -->
    <footer class="site-footer">
      <div class="footer-content">
        <div class="footer-section">
          <h3>OBLIVION</h3>
          <p>La tua piattaforma di streaming gratuita per film e serie TV.</p>
          <div class="social-links">
            <a href="#" aria-label="Facebook"><i class="fab fa-facebook"></i></a>
            <a href="#" aria-label="Twitter"><i class="fab fa-twitter"></i></a>
            <a href="#" aria-label="Instagram"><i class="fab fa-instagram"></i></a>
            <a href="#" aria-label="YouTube"><i class="fab fa-youtube"></i></a>
          </div>
        </div>
        
        <div class="footer-section">
          <h4>Navigazione</h4>
          <ul>
            <li><a href="#">Home</a></li>
            <li><a href="#">Film</a></li>
            <li><a href="#">Serie TV</a></li>
            <li><a href="#">Nuovi arrivi</a></li>
            <li><a href="#">Preferiti</a></li>
          </ul>
        </div>
        
        <div class="footer-section">
          <h4>Legale</h4>
          <ul>
            <li><a href="#">Termini di servizio</a></li>
            <li><a href="#">Privacy Policy</a></li>
            <li><a href="#">Cookie Policy</a></li>
            <li><a href="#">DMCA</a></li>
          </ul>
        </div>
        
        <div class="footer-section">
          <h4>Supporto</h4>
          <ul>
            <li><a href="#">FAQ</a></li>
            <li><a href="#">Contattaci</a></li>
            <li><a href="#">Segnala problema</a></li>
          </ul>
        </div>
      </div>
      
      <div class="footer-bottom">
        <p>&copy; 2023 OBLIVION. Tutti i diritti riservati. Questo sito è solo a scopo dimostrativo.</p>
        <p>I contenuti sono forniti da <a href="https://www.themoviedb.org/" target="_blank">TMDB</a>.</p>
      </div>
    </footer>

    <!-- Notifications -->
    <div class="notifications-container" id="notificationsContainer"></div>

    <!-- Scripts -->
    <script>
      // Inline script per rilevamento ad-blocker (come streamingunity)
      (function() {
        // Ad-block detection
        var adBlockEnabled = false;
        var testAd = document.createElement('div');
        testAd.innerHTML = '&nbsp;';
        testAd.className = 'adsbox';
        document.body.appendChild(testAd);
        
        window.setTimeout(function() {
          if (testAd.offsetHeight === 0) {
            adBlockEnabled = true;
            document.getElementById('adblockWarning').style.display = 'block';
          }
          testAd.remove();
        }, 100);
        
        // Chiudi warning ad-block
        document.getElementById('closeAdblockWarning')?.addEventListener('click', function() {
          document.getElementById('adblockWarning').style.display = 'none';
        });
        
        // Gestione tema scuro/chiaro
        const themeToggle = document.getElementById('themeToggle');
        const currentTheme = localStorage.getItem('theme') || 'dark';
        
        if (currentTheme === 'dark') {
          document.body.classList.add('dark-theme');
          themeToggle.innerHTML = '<i class="fas fa-sun"></i>';
        }
        
        themeToggle.addEventListener('click', function() {
          document.body.classList.toggle('dark-theme');
          if (document.body.classList.contains('dark-theme')) {
            localStorage.setItem('theme', 'dark');
            themeToggle.innerHTML = '<i class="fas fa-sun"></i>';
          } else {
            localStorage.setItem('theme', 'light');
            themeToggle.innerHTML = '<i class="fas fa-moon"></i>';
          }
        });
        
        // Performance monitoring
        window.addEventListener('load', function() {
          if ('performance' in window) {
            const perfEntries = performance.getEntriesByType('navigation');
            if (perfEntries.length > 0) {
              const navEntry = perfEntries[0];
              console.log('Page load time:', navEntry.loadEventEnd - navEntry.startTime, 'ms');
            }
          }
        });
      })();
    </script>
    
    <script src="js/tmdb.js"></script>
    <script src="js/app.js"></script>
    <script src="js/utils.js"></script>
    <script src="js/storage.js"></script>
  </body>
</html>
